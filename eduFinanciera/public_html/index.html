<!doctype html>
<!--[if lt IE 7]> <html class="ie6 oldie"> <![endif]-->
<!--[if IE 7]>    <html class="ie7 oldie"> <![endif]-->
<!--[if IE 8]>    <html class="ie8 oldie"> <![endif]-->
<!--[if gt IE 8]><!-->
<html class="">
    <!--<![endif]-->
    <head>
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <title>Documento sin título</title>
        <link href="css/boilerplate.css" rel="stylesheet" type="text/css">
        <link href="css/cuadricula.css" rel="stylesheet" type="text/css">
        <link href="css/style.css" rel="stylesheet" type="text/css" media="screen"/>
        <link href="css/botones.css" rel="stylesheet" type="text/css" media="screen"/>
        <script src="js/facebook.js"></script>
        <script src="js/respond.min.js"></script>
        <script  src="js/jquery-1.10.2.min.js" type="text/javascript"></script>
        <script type="text/javascript" charset="utf-8" src="PushNotification.js"></script>
        <script type="text/javascript" charset="utf-8">

        document.addEventListener("deviceready", function(){        
        
          var pushNotification = window.plugins.pushNotification;
          
          if ( device.platform == 'android' || device.platform == 'Android' )
            {
                
                pushNotification.register(
                    successHandler,
                    errorHandler, {
                        "senderID":"745427093313",
                        "ecb":"onNotificationGCM"
                    });
            }
            else
            {
                
                pushNotification.register(
                    tokenHandler,
                    errorHandler, {
                        "badge":"true",
                        "sound":"true",
                        "alert":"true",
                        "ecb":"onNotificationAPN"
                    });
            }
          
          
          
         }, true);
         
    function successHandler (result) {
    alert('result = ' + result);
    }
    
    function errorHandler (error) {
    alert('error = ' + error);
    }
    
    function onNotificationGCM(e) {
        //$("#app-status-ul").append('<li>EVENT -> RECEIVED:' + e.event + '</li>');

        switch( e.event )
        {
        case 'registered':
            if ( e.regid.length > 0 )
            {
                //$("#app-status-ul").append('<li>REGISTERED -> REGID:' + e.regid + "</li>");
                // Your GCM push server needs to know the regID before it can push to this device
                // here is where you might want to send it the regID for later use.
                //console.log("regID = " + e.regid);
                localStorage.setItem('regid', e.regid);
            }
        break;

        case 'message':
            // if this flag is set, this notification happened while we were in the foreground.
            // you might want to play a sound to get the user's attention, throw up a dialog, etc.
            if ( e.foreground )
            {
                //$("#app-status-ul").append('<li>--INLINE NOTIFICATION--' + '</li>');

                // if the notification contains a soundname, play it.
                //var my_media = new Media("/android_asset/www/"+e.soundname);
                //my_media.play();
            }
            else
            {  // otherwise we were launched because the user touched a notification in the notification tray.
                if ( e.coldstart )
                {
                   // $("#app-status-ul").append('<li>--COLDSTART NOTIFICATION--' + '</li>');
                }
                else
                {
                   // $("#app-status-ul").append('<li>--BACKGROUND NOTIFICATION--' + '</li>');
                }
            }

           // $("#app-status-ul").append('<li>MESSAGE -> MSG: ' + e.payload.message + '</li>');
           // $("#app-status-ul").append('<li>MESSAGE -> MSGCNT: ' + e.payload.msgcnt + '</li>');
        break;

        case 'error':
           // $("#app-status-ul").append('<li>ERROR -> MSG:' + e.msg + '</li>');
        break;

        default:
            //$("#app-status-ul").append('<li>EVENT -> Unknown, an event was received and we do not know what it is</li>');
        break;
      }
    }

            $(window).ready(function() {
                var idFace = localStorage.getItem('idFace');
                var grupo = localStorage.getItem('grupo');
                
                if(idFace == null || idFace == ""){
                    obtenerCategorias();
                    
                }else{
                    
                    
                    
                }
                
                
                if (grupo == null || grupo == ""){
                    location.href = 'edades.html';
                }
                
                
                
                
            });
            function obtenerCategorias() {
                var categorias = new Array();
                $.ajax({
                    type: "POST",
                    dataType: 'jsonp',
                    url: "http://servicedatosabiertoscolombia.cloudapp.net/v1/Banco_Agrario/banagrario?$format=json",
                    data: ""
                })
                        .done(function(msg) {
                            var i;
                            for (i = 0; i < msg.d.length; i++) {
                                categorias.push(msg.d[i].idcategoria+","+msg.d[i].categoria);
                            }
                            listarCategorias(array_unique(categorias));
                        });
            }
            
            function temas(idCategoria){
                localStorage.setItem('idCategoria',idCategoria);
                window.location.href = "page2.html";
            }

            function listarCategorias(categorias) {
                var i;
                var j = 0;
                var m = "";
                for (i = 0; i < categorias.length; i++) {
                    var msj = "";
                    j++;
                    if(j==1){
                        msj+="<tr>";
                    }
                    var res = categorias[i].split(",");
                    switch (res[0]) {

                        case "1":  
                                msj+='<td><div id="img"><img onclick="temas('+res[0]+')" src="img/ahorro.png" /><br><span>'+res[1]+'</span></div></td>';
                            break;
                        case "2":
                                msj+='<td><div id="img"><img onclick="temas('+res[0]+')" src="img/canalesDeAtencion.png" /><br><span>'+res[1]+'</span></div></td>';
                            break;
                        case "3":
                                msj+='<td><div id="img"><img onclick="temas('+res[0]+')" src="img/credito.png" /><br><span>'+res[1]+'</span></div></td>';
                            break;
                        case "4":
                                msj+='<td><div id="img"><img onclick="temas('+res[0]+')" src="img/derechosYDeberes.png" /><br><span>'+res[1]+'</span></div></td>';
                            break;
                        case "5":
                                msj+='<td><div id="img"><img onclick="temas('+res[0]+')" src="img/fiducia.png" /><br><span>'+res[1]+'</span></div></td>';
                            break;
                        case "6":
                                msj+='<td><div id="img"><img onclick="temas('+res[0]+')" src="img/fondoDeInversionColectiva.png" /><br><span>'+res[1]+'</span></div></td>';
                            break;
                        case "7":
                                msj+='<td><div id="img"><img onclick="temas('+res[0]+')" src="img/organismosDeVigilanciaYControl.png" /><br><span>'+res[1]+'</span></div></td>';
                            break;
                        case "8":
                                msj+='<td><div id="img"><img onclick="temas('+res[0]+')" src="img/presupuesto.png" /><br><span>'+res[1]+'</span></div></td>';
                            break;    
                    }
                    if(j==3 || i==categorias.length-1){
                        msj+="</tr>";
                        j=0;
                    }
                   
                    m+=msj;
                    
                }
                $("#tablaCat").append(m);
            }

            function array_unique(arr) {

                if (arr.length > 1) {

                    var arr = arr.sort();
                    var arrUnique = new Array(arr[0]);
                    for (i = 1; i < arr.length; i++) {
                        if (arr[i] != arrUnique[arrUnique.length - 1]) {

                            arrUnique.push(arr[i]);
                        }

                    }
                    return arrUnique;
                }
                
                else {
                    return arr;
                }
            }

        </script>
    </head>
    <body>
        <div class="cabecera" id="cabeceraVerdé">NOMBRE DE LA APLICACION</div>
        <div class="gridContainer clearfix">

            <div id="LayoutDiv1">
                <table id="tablaCat" align="center" width="100%">
                    
                </table>

            </div>
            <div id="btnFace">
                <button class="button large blue" onclick="facebook()">Conectate con facebook!</button>
        	</div>
        </div>
    </body>
</html>
